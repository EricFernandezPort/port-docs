import Tabs from "@theme/Tabs"
import TabItem from "@theme/TabItem"
import AdvancedConfig from '../../../generalTemplates/_ocean_advanced_configuration_note.md'
import AzurePremise from "../templates/\_ocean_azure_premise.mdx"
import DockerParameters from "./\_kafka_one_time_docker_params.mdx"
import HelmParameters from "../templates/\_ocean-advanced-parameters-helm.mdx"
import PortApiRegionTip from "/docs/generalTemplates/_port_region_parameter_explanation_template.md"


# Event catalog

Port acts as an event catalog for event-driven architectures, serving as a centralized repository for your event schemas, API schemas, documentation, as well as mapping the relationships between event producers and consumers in your overall architecture.

## Common use cases

- Map relationships between events, producers, and consumers in your event-driven architecture.
- Document all event schemas and APIs so developers have the information needed to write new services.
- Automatically ingest schemas, producer/consumer relationships, and APIs to ensure the catalog is up to date.

## Data model overview

<img src='/img/build-your-software-catalog/sync-data-to-catalog/event-processing/event-catalog-data-model.png' width='100%' />

Your architecture in Port will consist of four blueprints: `Producer`, `Event Broker`, `Event`, and `Consumer`. The structure of these blueprints may vary based on your architecture and may be different than the examples provided in this guide.

### Producer

- The `Producer` blueprint represents services that will generate events. It has a [relation](https://docs.getport.io/build-your-software-catalog/customize-integrations/configure-data-model/relate-blueprints/) connecting it to the event broker blueprint.
  
### Event broker

- The `Event Broker` blueprint represents services that will act as a queue for events and route them to the proper consumer. The `Event Broker` blueprint has one relation with the `Event` blueprint for events that are ingested by the broker, another relation with the `Event` blueprint for events that are produced from the broker, and finally the broker has a relation connecting it to the `Consumer` blueprint. 

### Event

- The `Event` blueprint forms the schema for tracking unique events in your event-driven architecture. It has a relation connecting it to the producers which originally generated the event and a relation connecting it to the consumers which consumed the event. 

### Consumer

- The `Consumer` blueprint represents services that consume events generated by the event broker.


## Event catalog configuration

### Blueprint creation

:::tip Already deployed?
If you already have blueprints in Port for your event producer, event consumer, and event broker you can skip the deployment for those blueprints and deploy just the event blueprint. You will still have to modify the blueprints to create relations between the different components in your event-driven architecture.
:::

To create an event catalog, we first need to create the  `Producer`, `Event Broker`, `Event`, and `Consumer` blueprints in our data model. This includes defining the relations between the blueprints in your architecture in the `relations` section of each JSON. Examples for each blueprint including the relation configuration are provided below, but the exact configuration of your blueprints will differ from the examples provided here depending on your architecture.

:::tip Don't know how to deploy blueprints?
Check out this [guide](https://docs.getport.io/build-your-software-catalog/customize-integrations/configure-data-model/setup-blueprint/) on how to deploy blueprints in Port
:::

<details>
<summary>Example producer blueprint</summary>

```json showLineNumbers
{
  "identifier": "producer",
  "description": "This blueprint represents an event Producer in our software catalog",
  "title": "Producer",
  "icon": "Lambda",
  "schema": {
    "properties": {
      "link": {
        "type": "string",
        "format": "url",
        "title": "Link"
      },
      "description": {
        "type": "string",
        "title": "Description"
      },
      "memorySize": {
        "type": "number",
        "title": "Memory Size"
      },
      "ephemeralStorageSize": {
        "type": "number",
        "title": "Ephemeral Storage Size"
      },
      "timeout": {
        "type": "number",
        "title": "Timeout"
      },
      "runtime": {
        "type": "string",
        "title": "Runtime"
      },
      "packageType": {
        "type": "string",
        "enum": [
          "Image",
          "Zip"
        ],
        "title": "Package Type"
      },
      "environment": {
        "type": "object",
        "title": "Environment"
      },
      "architectures": {
        "type": "array",
        "items": {
          "type": "string",
          "enum": [
            "x86_64",
            "arm64"
          ]
        },
        "title": "Architectures"
      },
      "layers": {
        "type": "array",
        "title": "Layers"
      },
      "tags": {
        "type": "array",
        "title": "Tags"
      },
      "iamRole": {
        "type": "string",
        "format": "url",
        "title": "IAM Role",
        "icon": "Unlock"
      },
      "arn": {
        "type": "string",
        "title": "ARN"
      }
    },
    "required": []
  },
  "mirrorProperties": {},
  "calculationProperties": {},
  "aggregationProperties": {},
  "relations": {}
}
```
</details>

<details>
<summary>Example event broker blueprint</summary>

```json showLineNumbers
{
  "identifier": "broker",
  "title": "Event Broker",
  "icon": "GitLab",
  "schema": {
    "properties": {
      "readme": {
        "title": "README",
        "type": "string",
        "format": "markdown",
        "icon": "Book"
      },
      "url": {
        "title": "URL",
        "format": "url",
        "type": "string",
        "icon": "Link"
      },
      "language": {
        "icon": "Git",
        "type": "string",
        "title": "Language",
        "enum": [
          "GO",
          "Python",
          "Node",
          "React"
        ],
        "enumColors": {
          "GO": "red",
          "Python": "green",
          "Node": "blue",
          "React": "yellow"
        }
      },
      "code_owners": {
        "title": "Code owners",
        "description": "This service's code owners",
        "type": "array",
        "icon": "TwoUsers",
        "items": {
          "type": "string",
          "format": "user"
        }
      },
      "type": {
        "title": "Type",
        "description": "This service's type",
        "type": "string",
        "enum": [
          "Backend",
          "Frontend",
          "Library"
        ],
        "enumColors": {
          "Backend": "purple",
          "Frontend": "pink",
          "Library": "green"
        },
        "icon": "DefaultProperty"
      },
      "lifecycle": {
        "title": "Lifecycle",
        "type": "string",
        "enum": [
          "Production",
          "Experimental",
          "Deprecated"
        ],
        "enumColors": {
          "Production": "green",
          "Experimental": "yellow",
          "Deprecated": "red"
        },
        "icon": "DefaultProperty"
      },
      "locked_in_prod": {
        "icon": "DefaultProperty",
        "title": "Locked in Prod",
        "type": "boolean",
        "default": false
      },
      "locked_reason_prod": {
        "icon": "DefaultProperty",
        "title": "Locked Reason Prod",
        "type": "string"
      }
    },
    "required": []
  },
  "mirrorProperties": {},
  "calculationProperties": {},
  "aggregationProperties": {},
  "relations": {}
}
```
</details>


<details>
<summary>Example event blueprint</summary>

```json showLineNumbers
{
  "identifier": "event",
  "title": "Event",
  "icon": "Mail",
  "schema": {
    "properties": {
      "async_api": {
        "type": "object",
        "title": "AsyncAPI",
        "icon": "ApiDoc",
        "spec": "async-api"
      },
      "repository": {
        "type": "string",
        "title": "Repository",
        "icon": "Github",
        "format": "url"
      },
      "readme": {
        "icon": "Docs",
        "type": "string",
        "title": "README",
        "format": "markdown"
      },
      "code_samples": {
        "type": "string",
        "title": "Code Samples",
        "icon": "Docs",
        "format": "markdown"
      },
      "mermaid_diagram": {
        "icon": "DefaultProperty",
        "type": "string",
        "title": "Mermaid",
        "format": "markdown"
      },
      "labels": {
        "icon": "DefaultProperty",
        "type": "array",
        "title": "Labels",
        "items": {
          "enum": [
            "Auditing",
            "Critical",
            "Data Lake"
          ],
          "enumColors": {
            "Auditing": "green",
            "Critical": "red",
            "Data Lake": "blue"
          },
          "type": "string"
        }
      },
      "version": {
        "type": "string",
        "title": "Version",
        "icon": "Rocket"
      },
      "deprecated": {
        "type": "boolean",
        "title": "Deprecated?",
        "default": false
      },
      "deprecation_date": {
        "type": "string",
        "title": "Deprecation Date",
        "icon": "Clock",
        "format": "date-time"
      },
      "event_schema": {
        "type": "string",
        "title": "Event Schema",
        "icon": "Docs",
        "format": "markdown"
      },
      "number_of_consumers": {
        "title": "Number of Consumers",
        "icon": "DefaultProperty",
        "type": "number"
      },
      "number_of_producers": {
        "title": "Number Of Producers",
        "icon": "DefaultProperty",
        "type": "number"
      }
    },
    "required": [
      "deprecated"
    ]
  },
  "mirrorProperties": {},
  "calculationProperties": {},
  "aggregationProperties": {},
  "relations": {}
}
```
</details>

<details>
<summary>Example consumer blueprint</summary>

```json showLineNumbers
{
  "identifier": "consumer",
  "title": "Consumer",
  "icon": "User",
  "schema": {
    "properties": {
      "confluence_docs": {
        "icon": "Confluence",
        "type": "string",
        "title": "Docs",
        "format": "url"
      },
      "owners": {
        "icon": "TwoUsers",
        "type": "array",
        "title": "Owners",
        "items": {
          "type": "string",
          "format": "user"
        }
      }
    },
    "required": []
  },
  "mirrorProperties": {},
  "calculationProperties": {},
  "aggregationProperties": {},
  "relations": {}
}
```
</details>

With all blueprints deployed, you should see all the blueprint categories in your Port catalog like this.

<img src='/img/build-your-software-catalog/sync-data-to-catalog/event-processing/event-catalog-post-blueprint-deployment-catalog-view.png' width='100%' />

### Entity creation

After generating all the blueprints, you'll want to test your data model out by creating example entities based on each of the blueprints you created. In a real production environment, you'd likely be generating these entities either automatically via an API call or one of our integrations. 

:::tip Don't know how to create entities programmatically?
Check out this [guide](https://docs.getport.io/api-reference/create-an-entity/) on how to create entities in Port programmatically 
:::

<details>
<summary>Consumer creation</summary>

1. Go to your catalog.
2. Navigate to the consumer tab.
3. Click on the create a consumer button.
4. Enter the title for your consumer.
5. Hit the create button. 

<img src='/img/build-your-software-catalog/sync-data-to-catalog/event-processing/event-catalog-create-consumer-entity.png' width='100%' />
</details>

<details>
<summary>Event creation</summary>

1. Navigate to the event tab, click the create an event button, and enter the title for the event.
2. Set the consumer that consumes this event by selecting the consumer you just created in the `Consumers` dropdown.

<img src='/img/build-your-software-catalog/sync-data-to-catalog/event-processing/event-catalog-create-event-entity.png' width='100%' />
</details>

<details>
<summary>Event broker creation</summary>

1. Navigate to the event broker tab, click the create an event broker button, and enter the title for the event broker.
2. Select the event and consumer entities you just created in the `Event I Produce` and `Consumer` dropdown  

<img src='/img/build-your-software-catalog/sync-data-to-catalog/event-processing/event-catalog-create-event-pipeline-entity.png' width='100%' />
</details>

<details>
<summary>Producer creation</summary>

1. Navigate to the producer tab, click the create a producer button, and enter the title for the producer.
2. Select the event and event broker entities you just created in the `Event I Produce` and `Event Broker` dropdown  

<img src='/img/build-your-software-catalog/sync-data-to-catalog/event-processing/event-catalog-create-event-producer-entity.png' width='100%' />
</details>

<details>
<summary>Linking event entity to event broker entity</summary>

1. Navigate to the event tab and edit the event entity you just created by clicking on the three dots to the right of the event.
2. Change the  `Event Broker I'm Sent To` field to the example event broker you just created

<img src='/img/build-your-software-catalog/sync-data-to-catalog/event-processing/event-catalog-link-event-entity-to-broker-entity.png' width='100%' />
</details>

After linking the event to the event broker your example event catalog is done. 

## Review of Event Catalog

With your event catalog configured and example entities populating your data model, let's take a look at what your events look like. Navigate to the Events tab and click on the example event entity you created. You should see something like the image below. 

<img src='/img/build-your-software-catalog/sync-data-to-catalog/event-processing/event-catalog-completed-event-entity-example.png' width='100%' />

You can see this event has fields for a README, code samples, mermaid architecture diagrams, and schemas allowing you to have a one stop shop to understand how to ingest and use an event. The event includes a audit log to see any changes made to the schema or event, serving as a repository for event schema or API changes. 

Additionally, in the `Related Entities` section, you'll see the entities in Port that are related to the event. You can see the consumer of the event, in addition to the producer and event broker entities that generated the event.

The arrow in the related entities section indicates whether the event was generated by the related entity or sent to the related entity. This related entity section can be configured by modifying the relations section of the your blueprint for each component in your architecture.
